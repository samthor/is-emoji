<style>
  canvas {
    image-rendering: -moz-crisp-edges;
    image-rendering: pixelated;
  }
  input {
    font: inherit;
    font-family: 'Segoe UI Emoji', 'Segoe UI Symbol', 'Apple Color Emoji', 'Helvetica Neue', 'Helvetica', sans-serif;
  }
  pre {
    line-height: 1.5;
  }
</style>
<script type="module">

import * as encoding from './src/encoding.js';
import * as variants from './src/variants.js';
import * as expando from './src/expando.js';

import {normalize} from './src/valid.js';
import {jsdecode} from './src/string.js';
import {prepare, supported} from './src/measure.js';

prepare(true);  // show debug

function renderVariants(object) {
  if (object === null) {
    return '';
  }
  const enc = (key) => {
    const v = object[key];
    return `\n  ${key} ${encoding.single(v)} ${hex(v)} ${supported(encoding.single(v))}`;
  };
  return Object.keys(object).map(enc).join('');
}

function hex(all) {
  if (typeof all === 'string') {
    all = Array.from(all).map((x) => x.codePointAt(0));
  }
  return `[${all.map((x) => x.toString(16)).join(', ')}]`;
}

text.oninput = () => {
  const r = text.value;
  if (!r) {
    history.replaceState(null, null, window.location.pathname);
    out.textContent = '';
    return;
  }
  history.replaceState(null, null, '#' + window.encodeURIComponent(r));

  const {s: normalized, unknownMulti} = normalize(r);

  out.textContent = `whole support: ${supported(r)}
  normalized: ${normalized} (unknownMulti=${unknownMulti})

`;

  for (const enc of encoding.iterate(r)) {
    const base = variants.singleBase(enc);
    const v = renderVariants(variants.genderVariants(base));
    const text = `base: ${encoding.single(base)} ${hex(base)} => ${hex(encoding.single(base))}
tone: ${variants.supportsTone(base) ? (variants.supportsDoubleTone(base) ? 'double' : 'yes') : 'no'}${v ? '\nvariants: ' + v : ''}
supported: ${supported(encoding.single(base))}

`;
    out.append(text);
  }
};

text.value = window.decodeURIComponent(window.location.hash.substr(1));
text.oninput();

</script>

<input type="text" id="text" />
<pre id="out"></pre>
