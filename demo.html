<style>
  canvas {
    image-rendering: -moz-crisp-edges;
    image-rendering: pixelated;
  }
  input {
    font-family: 'Lato', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Apple Color Emoji', 'Helvetica Neue', 'Helvetica', sans-serif;
  }
</style>
<script type="module">

import * as encoding from './src/encoding.js';
import * as variants from './src/variants.js';
import * as expando from './src/expando.js';

import {jsdecode} from './src/string.js';
import {supported} from './src/measure.js';

// import {emojiPointCount} from './src/emoji.js';
// import {countRenderPoints, isSingleValidEmoji, isSingleAmbig} from './src/measurer.js';

// import isExpectedLength from './index.js';  // use default import

// ambig.textContent = `ambig=${isSingleAmbig}`;

function renderVariants(object) {
  if (object === null) {
    return '';
  }
  const enc = (key) => {
    const v = object[key];
    return `\n  ${key} ${encoding.single(v)} ${hex(v)} ${supported(encoding.single(v))}`;
  };
  return Object.keys(object).map(enc).join('');
}

function hex(all) {
  return `[${all.map((x) => x.toString(16)).join(', ')}]`;
}

text.oninput = () => {
  const r = text.value;
  if (!r) {
    out.textContent = '';
    return;
  }

  console.info('raw', hex(jsdecode(r)), 'parsed', Array.from(encoding.iterate(r)).map(hex).join(', '));

  const enc = encoding.split(r)[0];

  const base = variants.singleBase(enc);
  const v = `base: ${encoding.single(base)} ${hex(base)}
tone: ${variants.supportsTone(base) ? (variants.supportsDoubleTone(base) ? 'double' : 'yes') : 'no'}
variants: ${renderVariants(variants.genderVariants(base))}
supported: ${supported(encoding.single(base))} (orig: ${supported(encoding.single(enc))})`;
  out.textContent = v;

  const runs = 1000;
  console.debug('runs', runs);

  const c = encoding.single(base);
  console.time('checks');
  for (let i = 0; i < runs; ++i) {
    supported(c);
  }
  console.timeEnd('checks');
};

text.value = '➡️';
text.oninput();

</script>

<input type="text" id="text" />
<pre id="out"></pre>
